{% extends "base.html" %}

{% block content %}
<h1>Select Tools for Stage: {{ stage }}</h1>
<form method="POST">
    {% if tools %}
    <h3>Available Tools:</h3>
    {% for tool in tools %}
    <div class="form-check">
        <input
            class="form-check-input"
            type="checkbox"
            name="tools"
            id="{{ tool }}"
            value="{{ tool }}"
            {% if tool == "none" %} onchange="handleNoneSelection(this)" {% else %} onchange="uncheckNone()" {% endif %}
        />
        <label class="form-check-label" for="{{ tool }}">{{ tool }}</label>
    </div>
    {% endfor %}
    {% endif %}

    <div class="mt-3" id="customToolContainer">
        <label>Add Custom Tools:</label>
        <div class="input-group mb-2 custom-tool-group">
            <input
                type="text"
                name="custom_tool"
                class="form-control custom-tool-input"
                placeholder="Enter custom tool"
            />
            <button
                type="button"
                class="btn btn-danger"
                onclick="removeCustomToolField(this)"
            >
                Remove
            </button>
        </div>
        <button
            type="button"
            class="btn btn-secondary mt-2"
            onclick="addCustomToolField()"
        >
            Add Another Tool
        </button>
    </div>

    <button type="submit" class="btn btn-primary mt-3">Next</button>
</form>

<script>
    function handleNoneSelection(checkbox) {
        if (checkbox.checked) {
            const toolCheckboxes = document.querySelectorAll('input[name="tools"]');
            toolCheckboxes.forEach((cb) => {
                if (cb.id !== "none") cb.checked = false;
            });
        }
    }

    function uncheckNone() {
        const noneCheckbox = document.getElementById("none");
        if (noneCheckbox) noneCheckbox.checked = false;
    }

    function addCustomToolField() {
        const container = document.getElementById("customToolContainer");
        const newField = document.createElement("div");
        newField.className = "input-group mb-2 custom-tool-group";
        newField.innerHTML = `
            <input type="text" name="custom_tool" class="form-control custom-tool-input" placeholder="Enter custom tool" />
            <button type="button" class="btn btn-danger" onclick="removeCustomToolField(this)">Remove</button>
        `;
        container.appendChild(newField);
    }

    function removeCustomToolField(buttonElement) {
        const fieldToRemove = buttonElement.parentNode;
        fieldToRemove.parentNode.removeChild(fieldToRemove);
    }
</script>
{% endblock %}
