{% extends "base.html" %} {% block content %}
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Font Awesome -->

  <!-- Custom CSS -->
  <link
    rel="stylesheet"
    href="{{ url_for('static', filename='css/tools.css', v=1) }}"
  />
  <title>DevSecOps</title>
</head>
<div class="container">
  <h1>Select Tools for Stage: <br /><span>{{ stage }}</span></h1>

  <form method="POST" class="level-form">
    {% if tools %}
    <h3 class="subtitle">Available Tools:</h3>
    {% for tool in tools %}
    <div class="level-option">
      <input type="checkbox" name="tools" id="{{ tool }}" value="{{ tool }}" {%
      if tool == "none" %} onchange="handleNoneSelection(this)" {% else %}
      onchange="uncheckNone()" {% endif %} />
      <label class="level-label" for="{{ tool }}">
        <div class="level-name">{{ tool }}</div>
      </label>
    </div>
    {% endfor %} {% endif %}

    <div class="mt-3">
      <h4>Add Custom Tools:</h4>
      <div class="input-group mb-2">
        <input
          type="text"
          id="customToolInput"
          class="form-control"
          placeholder="Enter custom tool"
        />
        <button type="button" class="btn-success" onclick="addCustomTool()">
          ADD
        </button>
      </div>
    </div>

    <div class="mt-3" id="customToolContainer">
      <h4>Added Custom Tools:</h4>
      <div class="custom-tool-template" style="display: none">
        <div class="input-group">
          <input type="text" class="form-control" readonly />
          <button
            type="button"
            class="btn-danger"
            onclick="removeCustomTool(this)"
          >
            REMOVE
          </button>
        </div>
      </div>
    </div>

    <div class="button-container">
      <button type="submit" class="btn">NEXT</button>
    </div>
  </form>
</div>

<script>
  function addCustomTool() {
    const inputField = document.getElementById("customToolInput");
    const customToolName = inputField.value.trim();

    if (!customToolName) {
      alert("Please enter a tool name.");
      return;
    }

    const container = document.getElementById("customToolContainer");
    const template = document
      .querySelector(".custom-tool-template")
      .cloneNode(true);
    template.style.display = "flex";
    template.classList.remove("custom-tool-template");
    template.querySelector("input").value = customToolName;
    template.querySelector("input").name = "custom_tools[]";

    container.appendChild(template);
    inputField.value = "";
  }

  function removeCustomTool(button) {
    button.closest(".input-group").remove();
  }

  function handleNoneSelection(checkbox) {
    if (checkbox.checked) {
      document
        .querySelectorAll('input[type="checkbox"]:not(#none)')
        .forEach((cb) => {
          cb.checked = false;
        });
    }
  }

  function uncheckNone() {
    document.querySelector("#none").checked = false;
  }
</script>
{% endblock %}
